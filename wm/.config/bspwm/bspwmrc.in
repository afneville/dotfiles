#! /bin/sh

bspc rule -r *:*
killall sxhkd
killall -q polybar

get_colours () {
    FOREGROUND="$(xrdb -query | grep 'foreground:'| awk '{print $NF}')"
    BACKGROUND="$(xrdb -query | grep 'background:'| awk '{print $NF}')"
    CURSOR="$(xrdb -query | grep 'cursorColor:'| awk '{print $NF}')"
    BLACK="$(xrdb -query | grep 'color0:'| awk '{print $NF}')"
    RED="$(xrdb -query | grep 'color1:'| awk '{print $NF}')"
    GREEN="$(xrdb -query | grep 'color2:'| awk '{print $NF}')"
    YELLOW="$(xrdb -query | grep 'color3:'| awk '{print $NF}')"
    BLUE="$(xrdb -query | grep 'color4:'| awk '{print $NF}')"
    MAGENTA="$(xrdb -query | grep 'color5:'| awk '{print $NF}')"
    CYAN="$(xrdb -query | grep 'color6:'| awk '{print $NF}')"
    WHITE="$(xrdb -query | grep 'color7:'| awk '{print $NF}')"
    ALTBLACK="$(xrdb -query | grep 'color8:'| awk '{print $NF}')"
    ALTRED="$(xrdb -query | grep 'color9:'| awk '{print $NF}')"
    ALTGREEN="$(xrdb -query | grep 'color10:'| awk '{print $NF}')"
    ALTYELLOW="$(xrdb -query | grep 'color11:'| awk '{print $NF}')"
    ALTBLUE="$(xrdb -query | grep 'color12:'| awk '{print $NF}')"
    ALTMAGENTA="$(xrdb -query | grep 'color13:'| awk '{print $NF}')"
    ALTCYAN="$(xrdb -query | grep 'color14:'| awk '{print $NF}')"
    ALTWHITE="$(xrdb -query | grep 'color15:'| awk '{print $NF}')"
}

polybar_colours () {
	cat > $HOME/.config/polybar/colours.ini <<- EOF
	[color]
	foreground = ${FOREGROUND}
	background = ${BACKGROUND}
	black = ${BLACK}
	red = ${RED}
	green = ${GREEN}
	yellow = ${YELLOW}
	blue = ${BLUE}
	magenta = ${MAGENTA}
	cyan = ${CYAN}
	white = ${WHITE}
	altblack = ${ALTBLACK}
	altred = ${ALTRED}
	altgreen = ${ALTGREEN}
	altyellow = ${ALTYELLOW}
	altblue = ${ALTBLUE}
	altmagenta = ${ALTMAGENTA}
	altcyan = ${ALTCYAN}
	altwhite = ${ALTWHITE}
	EOF
}

xrdb ~/.Xresources
get_colours
polybar_colours
polybar %bar_dpi% &
bspc config focused_border_color "$ALTBLACK"
bspc config presel_feedback_color "$ALTBLACK"
bspc config normal_border_color "$ALTGREEN"
bspc config active_border_color "$ALTGREEN"
hsetroot -solid "$BACKGROUND"

sxhkd -c ~/.config/sxhkd/wm_bindings &
sxhkd -c ~/.config/sxhkd/app_bindings &

bspc monitor -d  1 2 3 4 5 6 7 8 9
bspc config border_width         %border_width%
bspc config split_ratio          0.50
bspc config borderless_monocle   true
bspc config gapless_monocle      true
bspc config focus_follows_pointer true
bspc config pointer_follows_focus true
bspc config top_padding %top_padding%
bspc config window_gap 0

bspc rule -a Emacs state=tiled
bspc rule -a Zathura state=tiled
